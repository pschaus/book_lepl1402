

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Functional Programming &#8212; LEPL1402  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Parallel Programming" href="part5.html" />

    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-125847974-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="part5.html" title="Parallel Programming"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">LEPL1402  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Functional Programming</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="functional-programming">
<span id="part6"></span><h1>Functional Programming<a class="headerlink" href="#functional-programming" title="Permalink to this heading">¶</a></h1>
<p>Functional programming refers to a programming paradigm that emphasizes the <strong>use of functions and immutable data</strong> to create applications. This paradigm promotes writing code that is easier to reason about, and that allows for better handling of concurrency.</p>
<p>While Java is not a pure functional language like Haskell, it offers many features that can be used to write more functional-style code. Functional programming in Java encourages the use of pure functions that have no side effect, i.e., that avoid changing the state of the program. Java 8 introduced features to support functional programming, primarily through the addition of functional interfaces, of lambda expressions, and of the <code class="docutils literal notranslate"><span class="pre">Stream</span></code> API.</p>
<section id="nesting-classes">
<h2>Nesting classes<a class="headerlink" href="#nesting-classes" title="Permalink to this heading">¶</a></h2>
<p>To begin our study of functional programming, we will first go back to the concept of nested classes that has previously been <a class="reference internal" href="part4.html#arithmetic-expression"><span class="std std-ref">briefly encountered</span></a>. A nested class is simply a <strong>class that is defined within another class</strong>. Note that a nested class can also define its own nested classes, just like Matryoshka dolls.</p>
<p>Let us consider the task of creating a spreadsheet application. A spreadsheet document is composed of a number of rows. Each row is made of several columns with string values. A data structure to represent a single row can be modeled as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Row</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">,</span>
<span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">columns</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">column</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">columns</span><span class="p">.</span><span class="na">getOrDefault</span><span class="p">(</span><span class="n">column</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="cm">/* default value if absent */</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Row</span></code> class uses an <a class="reference external" href="https://en.wikipedia.org/wiki/Associative_array">associative array</a> that maps integers (the index of the columns) to strings (the value of the columns). The use of an associated array allows to account for columns with a missing value. The standard <code class="docutils literal notranslate"><span class="pre">HashMap&lt;K,V&gt;</span></code> class is used to this end: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html">https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html</a></p>
<p>A basic spreadsheet application can then be created on the top of this <code class="docutils literal notranslate"><span class="pre">Row</span></code> class. Let us define a spreadsheet document as an ordered list of rows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Spreadsheet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Spreadsheet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">sortOnColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">rows</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
<span class="w">        </span><span class="n">sort</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSortOnColumn</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">sortOnColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>
<span class="w">        </span><span class="n">sort</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// We will implement this later on</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillWithSongs</span><span class="p">(</span><span class="n">Spreadsheet</span><span class="w"> </span><span class="n">spreadsheet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Row</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Row</span><span class="p">();</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pink Floyd&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The Dark Side of the Moon&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Money&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">spreadsheet</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>

<span class="w">        </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Row</span><span class="p">();</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The Beatles&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Abbey Road&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come Together&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">spreadsheet</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>

<span class="w">        </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Row</span><span class="p">();</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Queen&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A Night at the Opera&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">row</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bohemian Rhapsody&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">spreadsheet</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Spreadsheet</span><span class="w"> </span><span class="n">spreadsheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Spreadsheet</span><span class="p">();</span>
<span class="w">        </span><span class="n">fillWithSongs</span><span class="p">(</span><span class="n">spreadsheet</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This Java application creates a spreadsheet with 3 rows and 3 columns that are filled with information about 3 songs. If exported to a real-world spreadsheet application such as LibreOffice Calc, it would be rendered as follows:</p>
<a class="reference internal image-reference" href="_images/spreadsheet.png"><img alt="Spreadsheet" class="align-center" src="_images/spreadsheet.png" style="width: 480px;" /></a>
<section id="static-nested-classes">
<h3>Static nested classes<a class="headerlink" href="#static-nested-classes" title="Permalink to this heading">¶</a></h3>
<p>We are now interested in the task of continuously sorting the rows according to the values that are present in the columns, as new rows get added to the spreadsheet using the <code class="docutils literal notranslate"><span class="pre">addRow()</span></code> method.</p>
<p>To this end, the <code class="docutils literal notranslate"><span class="pre">Spreadsheet</span></code> class contains the member variable <code class="docutils literal notranslate"><span class="pre">sortOnColumn</span></code> that specifies on which column the sorting must be applied. That parameter can be set using the <code class="docutils literal notranslate"><span class="pre">setSortOnColumn()</span></code> setter method. We already know that the task of sorting the rows can be solved through <a class="reference internal" href="part2.html#delegation-comparator"><span class="std std-ref">delegation to a dedicated comparator</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">RowComparator1</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>

<span class="w">    </span><span class="n">RowComparator1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">column</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">column</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Spreadsheet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowComparator1</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RowComparator1</span></code> class is called an <strong>external class</strong> because it is located outside of the <code class="docutils literal notranslate"><span class="pre">Spreadsheet</span></code> class. This is not an issue because this sample code is quite short. But in real code, it might be important for readability to bring the comparator class closer to the method that uses it (in this case, <code class="docutils literal notranslate"><span class="pre">sort()</span></code>). This is why Java features <strong>static nested classes</strong>. This construction allows to define a class at the member level of another class:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Spreadsheet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RowComparator2</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>

<span class="w">        </span><span class="n">RowComparator2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">column</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">column</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowComparator2</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">RowComparator2</span></code> is the static nested class, and <code class="docutils literal notranslate"><span class="pre">Spreadsheet</span></code> is called its <strong>outer class</strong>. Note that <code class="docutils literal notranslate"><span class="pre">RowComparator2</span></code> could have been tagged with a <a class="reference internal" href="part2.html#visibility"><span class="std std-ref">public visibility</span></a> to make it accessible outside of <code class="docutils literal notranslate"><span class="pre">Spreadsheet</span></code>, in the case the developer felt like sorting collections of <code class="docutils literal notranslate"><span class="pre">Row</span></code> objects could make sense in other parts of the application.</p>
<p>Static nested classes are a way to logically group classes together, to improve code organization, and to encapsulate functionality within a larger class. This promotes a more modular and structured design, in a way that is similar to <a class="reference internal" href="part2.html#packages"><span class="std std-ref">packages</span></a>, but at a finer granularity. Note that it is allowed for two different classes to use the same name for a nested class, which can prevent collisions between class names in large applications.</p>
<p>Importantly, static nested classes have access to the private static members of the outer class, which was not the case of the external class <code class="docutils literal notranslate"><span class="pre">RowComparator1</span></code>: This can for instance be useful to take advantage of <a class="reference internal" href="part1.html#enumerations"><span class="std std-ref">private enumerations or constants</span></a> that would be defined inside the outer class.</p>
</section>
<section id="inner-classes">
<h3>Inner classes<a class="headerlink" href="#inner-classes" title="Permalink to this heading">¶</a></h3>
<p>The previous code has however a redundancy: The value of <code class="docutils literal notranslate"><span class="pre">sortOnColumn</span></code> must be manually copied to a private <code class="docutils literal notranslate"><span class="pre">column</span></code> variable of <code class="docutils literal notranslate"><span class="pre">RowComparator2</span></code> so that it can be used inside the <code class="docutils literal notranslate"><span class="pre">compare()</span></code> method. Can we do better? The answer is “yes”, thanks to the concept of non-static nested classes, that are formally known as <strong>inner classes</strong>. Java allows writing:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Spreadsheet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RowComparator3</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">column</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowComparator3</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is much more compact! In this code, <code class="docutils literal notranslate"><span class="pre">private</span> <span class="pre">static</span> <span class="pre">class</span></code> was simply replaced by <code class="docutils literal notranslate"><span class="pre">private</span> <span class="pre">class</span></code>. Thanks to this modification, <code class="docutils literal notranslate"><span class="pre">RowComparator3</span></code> becomes an inner class of the outer class <code class="docutils literal notranslate"><span class="pre">Spreadsheet</span></code>, which grants its <code class="docutils literal notranslate"><span class="pre">compare()</span></code> method a direct access to the <code class="docutils literal notranslate"><span class="pre">sortOnColumn</span></code> member variable.</p>
<p>Inner classes look very similar to static nested classes, but they do not have the <code class="docutils literal notranslate"><span class="pre">static</span></code> keyword. As can be seen, the methods of inner classes can not only access the static member variables of the outer class, but they can also transparently access any member of the object that constructed them (variables and methods, including private members). Note that inner classes were previously encountered in this course when the <a class="reference internal" href="part4.html#custom-iterators"><span class="std std-ref">implementation of custom iterators</span></a> was discussed.</p>
<p>It is tempting to systematically use inner classes instead of static nested classes. But pay attention to the fact that inner classes induce a much closer coupling with their outer classes, which can make it difficult to refactor the application, and which can quickly lead to the so-called <a class="reference external" href="https://refactoring.guru/fr/smells/feature-envy">Feature Envy</a> “code smell” (i.e. the <a class="reference external" href="https://en.wikipedia.org/wiki/Anti-pattern">opposite of a good design pattern</a>). Use an inner class only when you need access to the instance members of the outer class. Use a static nested class when there is no need for direct access to the outer class instance or when you want clearer namespacing and better code organization.</p>
</section>
<section id="syntactic-sugar">
<span id="id1"></span><h3>Syntactic sugar<a class="headerlink" href="#syntactic-sugar" title="Permalink to this heading">¶</a></h3>
<p>The fact that <code class="docutils literal notranslate"><span class="pre">compare()</span></code> has access to <code class="docutils literal notranslate"><span class="pre">sortOnColumn</span></code> might seem magic. This is actually an example of <strong>syntactic sugar</strong>. Syntactic sugar refers to language features or constructs that do not introduce new functionality but provide a more convenient or expressive way of writing code. These features make the code more readable or more concise without fundamentally changing how it operates. In essence, syntactic sugar is a shorthand or a more user-friendly syntax for expressing something that could be written in a longer or more explicit manner.</p>
<p>Syntactic sugar constructions were already encountered in this course. <a class="reference internal" href="part2.html#boxing"><span class="std std-ref">Autoboxing</span></a> is such a syntactic sugar. Indeed, the code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Integer</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w">  </span><span class="c1">// Autoboxing (from primitive type to wrapper)</span>
<span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w">   </span><span class="c1">// Auto unboxing (from wrapper to primitive type)</span>
</pre></div>
</div>
<p>is semantically equivalent to the more explicit code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Integer</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num</span><span class="p">.</span><span class="na">intValue</span><span class="p">();</span>
</pre></div>
</div>
<p>Thanks to its knowledge about the internals of the standard <code class="docutils literal notranslate"><span class="pre">java.lang.Integer</span></code> class, the compiler can automatically “fill the dots” by adding the constructor and selecting the proper conversion method. The <a class="reference internal" href="part4.html#id7"><span class="std std-ref">enhanced for-each loop for iterators</span></a> is another example of syntactic sugar, because writing:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="n">a</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="n">a</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">a</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>is semantically equivalent to:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the compiler comes across some <code class="docutils literal notranslate"><span class="pre">for()</span></code> loop on a collection that implements the standard <code class="docutils literal notranslate"><span class="pre">Iterable&lt;E&gt;</span></code> interface, it can transparently instantiate the iterator and traverse the collection using this iterator.</p>
<p>In the context of inner classes, the syntactic sugar consists in including a reference to the outer object that created the instance of the inner object. In our example, the compiler automatically transforms the <code class="docutils literal notranslate"><span class="pre">RowComparator3</span></code> class into the following static nested class:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Spreadsheet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sortOnColumn</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RowComparator4</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Spreadsheet</span><span class="w"> </span><span class="n">outer</span><span class="p">;</span><span class="w">  </span><span class="c1">// Reference to the outer object</span>

<span class="w">        </span><span class="n">RowComparator4</span><span class="p">(</span><span class="n">Spreadsheet</span><span class="w"> </span><span class="n">outer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outer</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">outer</span><span class="p">.</span><span class="na">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">outer</span><span class="p">.</span><span class="na">sortOnColumn</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowComparator4</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As can be seen, the compiler transparently adds a new argument to the constructor of the inner class, which contains the reference to the outer object.</p>
</section>
<section id="local-inner-classes">
<h3>Local inner classes<a class="headerlink" href="#local-inner-classes" title="Permalink to this heading">¶</a></h3>
<p>So far, we have seen three different constructions to define classes:</p>
<ul class="simple">
<li><p>External classes are the default way of defining classes, i.e., separately from any other class.</p></li>
<li><p>Static nested classes are members of an outer class. They have access to the static members of the outer class.</p></li>
<li><p>Inner classes are non-static members of an outer class. They are connected to the object that created them through syntactic sugar.</p></li>
</ul>
<p>Inner classes are great for the spreadsheet application, but code readability could still be improved if the <code class="docutils literal notranslate"><span class="pre">RowComparator3</span></code> class could somehow be brought <em>inside</em> the <code class="docutils literal notranslate"><span class="pre">sort()</span></code> method, because it is presumably the only location where this comparator would make sense in the application. This would make the one-to-one relation between the method and its comparator immediately apparent. This is the objective of <strong>local inner classes</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">RowComparator5</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowComparator5</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this new version of the <code class="docutils literal notranslate"><span class="pre">sort()</span></code> method, the comparator was defined within the scope of the method. The <code class="docutils literal notranslate"><span class="pre">RowComparator5</span></code> class is entirely local to <code class="docutils literal notranslate"><span class="pre">sort()</span></code>, and cannot be used in another method or class, which further reduces coupling.</p>
</section>
<section id="anonymous-inner-classes">
<span id="id2"></span><h3>Anonymous inner classes<a class="headerlink" href="#anonymous-inner-classes" title="Permalink to this heading">¶</a></h3>
<p>Because local inner classes are typically used at one single point of the method, it is generally not useful to give a name to local inner classes (in the previous example, this name was <code class="docutils literal notranslate"><span class="pre">RowComparator5</span></code>). Consequently, Java features the <strong>anonymous inner class</strong> construction:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">comparator</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As can be seen in this example, an anonymous inner class is a class that is defined without a name inside a method and that instantiated at the same place where it is defined.</p>
<p>This construction is often used for implementing interfaces or extending classes on-the-fly. To make this more apparent, note that we could have avoided the introduction of temporary variable <code class="docutils literal notranslate"><span class="pre">comparator</span></code> by directly writing:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Anonymous inner classes also correspond to another <a class="reference internal" href="#syntactic-sugar"><span class="std std-ref">syntactic sugar</span></a> construction, because an anonymous inner class can easily be converted into a local inner class by giving it a meaningless name.</p>
</section>
<section id="access-to-method-variables">
<h3>Access to method variables<a class="headerlink" href="#access-to-method-variables" title="Permalink to this heading">¶</a></h3>
<p>Importantly, both local inner classes and anonymous inner classes have <strong>access to the variables of their enclosing method</strong>.</p>
<p>To illustrate this point, let us consider the task of filling a matrix with a constant value using multiple threads. We could create one thread that fills the upper part of the matrix, and another thread that fills the lower part of the matrix. Using a <a class="reference internal" href="part5.html#thread-pools"><span class="std std-ref">thread pool</span></a> and the <code class="docutils literal notranslate"><span class="pre">SynchronizedMatrix</span></code> class that was defined to <a class="reference internal" href="part5.html#matrix-multiplication"><span class="std std-ref">demonstrate multithreading</span></a>, the corresponding implementation could be:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fill1</span><span class="p">(</span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">threadPool</span><span class="p">,</span>
<span class="w">                         </span><span class="n">SynchronizedMatrix</span><span class="w"> </span><span class="n">m</span><span class="p">,</span>
<span class="w">                         </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ExecutionException</span><span class="p">,</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">class</span> <span class="nc">Filler</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">startRow</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">endRow</span><span class="p">;</span>

<span class="w">        </span><span class="n">Filler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">startRow</span><span class="p">,</span>
<span class="w">               </span><span class="kt">int</span><span class="w"> </span><span class="n">endRow</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">startRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startRow</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">endRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endRow</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startRow</span><span class="p">;</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">endRow</span><span class="p">;</span><span class="w"> </span><span class="n">row</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getColumns</span><span class="p">();</span><span class="w"> </span><span class="n">column</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// The inner class has access to the &quot;m&quot; and &quot;value&quot; variables!</span>
<span class="w">                    </span><span class="n">m</span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Future</span><span class="w"> </span><span class="n">upperPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threadPool</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Filler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getRows</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="w">    </span><span class="n">Future</span><span class="w"> </span><span class="n">lowerPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threadPool</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Filler</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">getRows</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getRows</span><span class="p">()));</span>

<span class="w">    </span><span class="n">upperPart</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="w">    </span><span class="n">lowerPart</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As can be seen in this example, it is not necessary for the inner class <code class="docutils literal notranslate"><span class="pre">Filler</span></code> to explicitly store a copy of <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>. Indeed, because those two variables are part of the scope of method <code class="docutils literal notranslate"><span class="pre">fill1()</span></code>, the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method has direct access to the <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> variables. Actually, this is again <a class="reference internal" href="#syntactic-sugar"><span class="std std-ref">syntactic sugar</span></a>: The compiler automatically gives a <strong>copy of all the local variables of the surrounding method</strong> to the constructor of the inner class.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">fill1()</span></code> creates exactly two threads, one for each part of the matrix. One could want to take advantage of a higher number of CPU cores by reducing this granularity. According to this idea, here is an alternative implementation that introduces parallelism at the level of the individual rows of the matrix:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fill2</span><span class="p">(</span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">threadPool</span><span class="p">,</span>
<span class="w">                         </span><span class="n">SynchronizedMatrix</span><span class="w"> </span><span class="n">m</span><span class="p">,</span>
<span class="w">                         </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ExecutionException</span><span class="p">,</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pendingRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getRows</span><span class="p">();</span><span class="w"> </span><span class="n">row</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">myRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="p">;</span>

<span class="w">        </span><span class="n">pendingRows</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">threadPool</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getColumns</span><span class="p">();</span><span class="w"> </span><span class="n">column</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">m</span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span><span class="n">myRow</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pendingRows</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pendingRows</span><span class="p">.</span><span class="na">pop</span><span class="p">().</span><span class="na">get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Contrarily to <code class="docutils literal notranslate"><span class="pre">fill1()</span></code> that used a <em>local</em> inner class, the <code class="docutils literal notranslate"><span class="pre">fill2()</span></code> method uses an <em>anonymous</em> inner class, an instance of which is created for each row. This construction was not possible in the first implementation, because it had to separately track exactly two futures using two variables, which needed to share the definition of the inner class between the two separate runnables. However, in the second implementation, thanks to the fact that the multiple futures are tracked in a uniform way using a stack, the definition of the inner class can occur at a single place.</p>
<p>There is however a caveat associated with <code class="docutils literal notranslate"><span class="pre">fill2()</span></code>: One could expect to have access to the <code class="docutils literal notranslate"><span class="pre">row</span></code> variable inside the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method, because <code class="docutils literal notranslate"><span class="pre">row</span></code> is part of the scope of the enclosing method. However, the inner class might continue to exist and be used even after the loop has finished executing and the variable <code class="docutils literal notranslate"><span class="pre">row</span></code> has disappeared. To prevent potential issues arising from changes to variables after the start of the execution of a method, an inner class is actually only allowed to access the <strong>final variables</strong> in the scope of method (or variables that could have been tagged as <code class="docutils literal notranslate"><span class="pre">final</span></code>). Remember that a final variable means that it is <a class="reference internal" href="part2.html#final-keyword"><span class="std std-ref">not allowed to change its value later</span></a>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">fill2()</span></code> example, <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> could have been explicitly tagged as <code class="docutils literal notranslate"><span class="pre">final</span></code>, because their value does not change in the method. But adding a line like <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">10;</span></code> inside the method would break the compilation, because <code class="docutils literal notranslate"><span class="pre">value</span></code> could not be tagged as <code class="docutils literal notranslate"><span class="pre">final</span></code> anymore, which would prevent the use of <code class="docutils literal notranslate"><span class="pre">value</span></code> inside the runnable. One could argue that the <em>content</em> of <code class="docutils literal notranslate"><span class="pre">m</span></code> changes because of the calls to <code class="docutils literal notranslate"><span class="pre">m.setValue()</span></code>, however the <em>reference</em> to the object <code class="docutils literal notranslate"><span class="pre">m</span></code> that was originally provided as argument to the method never changes. Finally, the variable <code class="docutils literal notranslate"><span class="pre">row</span></code> cannot be declared as <code class="docutils literal notranslate"><span class="pre">final</span></code>, because its value changes during the loop. Storing a copy of <code class="docutils literal notranslate"><span class="pre">row</span></code> inside the variable <code class="docutils literal notranslate"><span class="pre">myRow</span></code> is a workaround to solve this issue.</p>
<div class="remark admonition">
<p class="admonition-title">Remark</p>
<p>The example of filling a matrix using multithreading is a bit academic, because for such an operation, the bottleneck will be the RAM, not the CPU. As a consequence, adding more CPU threads will probably never improve performance, and might even be detrimental because of the overhead associated with thread management. Furthermore, our class <code class="docutils literal notranslate"><span class="pre">SynchronizedMatrix</span></code> implements mutual exclusion for the access to the individual cells (i.e. the <code class="docutils literal notranslate"><span class="pre">setValue()</span></code> is tagged with the <code class="docutils literal notranslate"><span class="pre">synchronized</span></code> keyword), which will dramatically reduce the performance.</p>
</div>
</section>
</section>
<section id="functional-interfaces-and-lambda-functions">
<span id="lambda-expressions"></span><h2>Functional interfaces and lambda functions<a class="headerlink" href="#functional-interfaces-and-lambda-functions" title="Permalink to this heading">¶</a></h2>
<p>Since the beginning of our <a class="reference internal" href="part4.html#part4"><span class="std std-ref">exploration of object-oriented programming</span></a>, a recurrent pattern keeps appearing:</p>
<ul>
<li><p>During the <a class="reference internal" href="part2.html#delegation-comparator"><span class="std std-ref">delegation to comparators of objects</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TitleComparator</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Book</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="n">b2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="na">getTitle</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b2</span><span class="p">.</span><span class="na">getTitle</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>
<span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">books</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TitleComparator</span><span class="p">());</span>
</pre></div>
</div>
</li>
<li><p>Inside the <a class="reference internal" href="part2.html#observer"><span class="std std-ref">Observer Design Pattern</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">ButtonActionListener</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ActionListener</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">actionPerformed</span><span class="p">(</span><span class="n">ActionEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showMessageDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="s">&quot;Thank you!&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>
<span class="n">button</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ButtonActionListener</span><span class="p">());</span>
</pre></div>
</div>
</li>
<li><p>For <a class="reference internal" href="part5.html#runnable"><span class="std std-ref">specifying operations to be done by threads</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Computation</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">expensiveComputation</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>
<span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Computation</span><span class="p">());</span>
<span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<p>This recurrent pattern corresponds to simple classes that implement <strong>one single abstract method</strong> and that have <strong>no member</strong>.</p>
<p>The presence of a single method stems from the fact that these classes implement a <strong>single functional interface</strong>. In Java, a functional interface is defined as an <a class="reference internal" href="part2.html#interfaces"><span class="std std-ref">interface</span></a> that contains only one abstract method. Functional interfaces are also known as Single Abstract Method (SAM) interfaces. Functional interfaces are a key component of functional programming support introduced in Java 8. The interfaces <code class="docutils literal notranslate"><span class="pre">Comparator&lt;T&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">ActionListener</span></code>, <code class="docutils literal notranslate"><span class="pre">Runnable</span></code>, and <code class="docutils literal notranslate"><span class="pre">Callable&lt;T&gt;</span></code> are all examples of functional interfaces.</p>
<div class="remark admonition">
<p class="admonition-title">Advanced remarks</p>
<p>A functional interface can have multiple <code class="docutils literal notranslate"><span class="pre">default</span></code> methods or <code class="docutils literal notranslate"><span class="pre">static</span></code> methods without violating the rule of having a single abstract method. This course has not covered <code class="docutils literal notranslate"><span class="pre">default</span></code> methods, but it is sufficient to know that a <code class="docutils literal notranslate"><span class="pre">default</span></code> method provides a default implementation within an interface that the classes implementing the interface can choose to inherit or overwrite. For instance, the interface <code class="docutils literal notranslate"><span class="pre">Comparator&lt;T&gt;</span></code> comes with multiple <code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">static</span></code> methods, as can be seen in the Java documentation: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html">https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html</a></p>
<p>In Java 8 and later, the <code class="docutils literal notranslate"><span class="pre">&#64;FunctionalInterface</span></code> annotation helps explicitly mark an interface as a functional interface. If an interface annotated with <code class="docutils literal notranslate"><span class="pre">&#64;FunctionalInterface</span></code> contains more than one abstract method, the compiler generates an error to indicate that it does not meet the criteria of a functional interface. Nonetheless, pay attention to the fact that not all the functional interfaces of Java are annotated with <code class="docutils literal notranslate"><span class="pre">&#64;FunctionalInterface</span></code>. This is notably the case of <code class="docutils literal notranslate"><span class="pre">ActionListener</span></code>.</p>
</div>
<p>A <strong>lambda expression</strong> is an expression that creates an instance of an <a class="reference internal" href="#anonymous-inner-classes"><span class="std std-ref">anonymous inner class</span></a> that has no member and that implements a functional interface. Thanks to lambda expressions, the <code class="docutils literal notranslate"><span class="pre">sort()</span></code> method for our spreadsheet application can be shortened as a single line of code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">)));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As can be seen in this example, a lambda expression only specifies the name of the arguments and the body of the single abstract method of the functional interface it implements.</p>
<p>A lambda expression can only appear in a context that expects a value whose type is a functional interface. Once the Java compiler has determined which functional interface is expected for this context, it transparently instantiates a suitable anonymous inner class that implements the expected functional interface with the expected single method.</p>
<p>Concretely, in the <code class="docutils literal notranslate"><span class="pre">sort()</span></code> example, the compiler notices the construction <code class="code docutils literal notranslate"><span class="pre">Collections.sort(rows,</span> <span class="pre">lambda)</span></code>. Because <code class="docutils literal notranslate"><span class="pre">rows</span></code> has type <code class="docutils literal notranslate"><span class="pre">List&lt;Row&gt;</span></code>, the compiler looks for a static method in the <code class="docutils literal notranslate"><span class="pre">Collections</span></code> class that is named <code class="docutils literal notranslate"><span class="pre">sort()</span></code> and that takes as arguments a value of type <code class="docutils literal notranslate"><span class="pre">List&lt;Row&gt;</span></code> and a functional interface. As can be seen in the <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html">Java documentation</a>, the only matching method is <code class="code docutils literal notranslate"><span class="pre">Collections.sort(List&lt;T&gt;</span> <span class="pre">list,</span> <span class="pre">Comparator&lt;?</span> <span class="pre">super</span> <span class="pre">T&gt;</span> <span class="pre">c)</span></code>, with <code class="docutils literal notranslate"><span class="pre">T</span></code> corresponding to class <code class="docutils literal notranslate"><span class="pre">Row</span></code>. The compiler deduces that the functional interface of interest is <code class="docutils literal notranslate"><span class="pre">Comparator&lt;Row&gt;</span></code>, and it accordingly creates an anonymous inner class as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// &quot;Comparator&lt;Row&gt;&quot; is the functional interface that matches the lambda expression</span>
<span class="w">    </span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="c1">// The name of the single abstract method and the types of the arguments</span>
<span class="w">        </span><span class="c1">// are extracted from the functional interface. The name of the arguments</span>
<span class="w">        </span><span class="c1">// are taken from the lambda expression.</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// This is the body of the lambda expression</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">).</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sortOnColumn</span><span class="p">)));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In other words, lambda expressions are also <a class="reference internal" href="#syntactic-sugar"><span class="std std-ref">syntactic sugar</span></a>! Very importantly, <strong>functional interfaces provide a clear contract for the signature of the method that the matching lambda expression must implement</strong>, which is needed for this syntactic sugar to work.</p>
<p>Thanks to lambda expressions, the three examples at the beginning of this section could all be simplified as one-liners:</p>
<ul>
<li><p>During the <a class="reference internal" href="part2.html#delegation-comparator"><span class="std std-ref">delegation to comparators of objects</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">books</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="n">b2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b1</span><span class="p">.</span><span class="na">getTitle</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">b2</span><span class="p">.</span><span class="na">getTitle</span><span class="p">()));</span>
</pre></div>
</div>
</li>
<li><p>Inside the <a class="reference internal" href="part2.html#observer"><span class="std std-ref">Observer Design Pattern</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">button</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showMessageDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="s">&quot;Thank you!&quot;</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p>For <a class="reference internal" href="part5.html#runnable"><span class="std std-ref">specifying operations to be done by threads</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">expensiveComputation</span><span class="p">());</span>
</pre></div>
</div>
</li>
</ul>
<p>The general form of a lambda expression is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">,</span> <span class="n">B</span> <span class="n">b</span><span class="p">,</span> <span class="n">C</span> <span class="n">c</span> <span class="o">/*</span> <span class="o">...</span><span class="n">possibly</span> <span class="n">more</span> <span class="n">arguments</span> <span class="o">*/</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span>
  <span class="o">/*</span> <span class="n">Body</span> <span class="o">*/</span>
  <span class="k">return</span> <span class="o">/*</span> <span class="n">result</span> <span class="o">*/</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This general form can be lightened in different situations:</p>
<ul>
<li><p>If the compiler can deduce the types of the arguments, which is most commonly the case, you do not have to provide the types (e.g., <code class="docutils literal notranslate"><span class="pre">(A</span> <span class="pre">a,</span> <span class="pre">B</span> <span class="pre">b)</span></code> can be reduced as <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span></code>).</p></li>
<li><p>If the lambda expression takes one single argument, the parentheses can be removed (e.g., <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">...</span></code> is a synonym for <code class="docutils literal notranslate"><span class="pre">(a)</span> <span class="pre">-&gt;</span> <span class="pre">...</span></code>). Note that a lambda expression with no argument would be defined as <code class="docutils literal notranslate"><span class="pre">()</span> <span class="pre">-&gt;</span> <span class="pre">...</span></code>.</p></li>
<li><p>If the body of the lambda expression only contains the <code class="docutils literal notranslate"><span class="pre">return</span></code> instruction, the curly brackets and the <code class="docutils literal notranslate"><span class="pre">return</span></code> can be removed.</p></li>
<li><p>If the lambda expression returns <code class="docutils literal notranslate"><span class="pre">void</span></code> and if its body contains a single line, the curly brackets can be removed as well, for instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>It often happens that you want to write a lambda expression that simply calls a method and passes it the arguments it has received. In such situations, Java offers the notion of <strong>method reference</strong>. For instance, the following lambda expression that calls a static method:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>can be shortened as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span>
</pre></div>
</div>
<p>Similarly, the following lambda expression that calls a non-static method on a list of integers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">size</span><span class="p">()</span>
</pre></div>
</div>
<p>can be rewritten as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">::</span><span class="n">size</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="general-purpose-functional-interfaces">
<span id="id3"></span><h2>General-purpose functional interfaces<a class="headerlink" href="#general-purpose-functional-interfaces" title="Permalink to this heading">¶</a></h2>
<p>Lambda expressions can only be used in a context that expects a value whose type is a functional interface. It is therefore useful to have a number of such interfaces available, covering the main use cases.</p>
<p>This motivates the introduction of the <code class="docutils literal notranslate"><span class="pre">java.util.function</span></code> standard package that provides general-purpose definitions for:</p>
<ul class="simple">
<li><p>Unary functions (with one argument) and binary functions (with two arguments),</p></li>
<li><p>Unary and binary operators (functions whose result type is identical to the type of the argument), and</p></li>
<li><p>Unary and binary predicates (functions whose result type is Boolean).</p></li>
</ul>
<p>Make sure to have a look at Java documentation about general-purpose functions: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/package-summary.html">https://docs.oracle.com/javase/8/docs/api/java/util/function/package-summary.html</a></p>
<section id="unary-functions">
<span id="unary-function"></span><h3>Unary functions<a class="headerlink" href="#unary-functions" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">java.util.function.Function</span></code> interface represents a <strong>general-purpose function with one argument</strong>. The type <code class="docutils literal notranslate"><span class="pre">T</span></code> of this argument and the result type <code class="docutils literal notranslate"><span class="pre">R</span></code> of the function are the generics parameters of this interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The input type <code class="docutils literal notranslate"><span class="pre">T</span></code> and the result type <code class="docutils literal notranslate"><span class="pre">R</span></code> can be different. Together, they define the <strong>domain</strong> of the function. In mathematical notation, the corresponding function <img class="math" src="_images/math/5b7752c757e0b691a80ab8227eadb8a8389dc58a.svg" alt="f"/> would be defined as <img class="math" src="_images/math/f2070849872896b6c7f17478a3b66cff3fdef362.svg" alt="f:T \mapsto R"/>.</p>
<p>For instance, the following program first uses a lambda expression to define a function that computes the length of a string, then applies the function to a string:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">length</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// At this point, no actual computation is done: This is just a definition for &quot;f&quot;!</span>

<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 5</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As another example, here is a function that extracts the first character of a string in lower case:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Character</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Character</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: h</span>
</pre></div>
</div>
</section>
<section id="binary-functions">
<h3>Binary functions<a class="headerlink" href="#binary-functions" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">java.util.function.BiFunction</span></code> interface represents a <strong>general-purpose functional interface with two arguments</strong> of different types, and with a separate result type:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">R</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">u</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In mathematical notation, the corresponding function <img class="math" src="_images/math/5b7752c757e0b691a80ab8227eadb8a8389dc58a.svg" alt="f"/> has domain <img class="math" src="_images/math/ecfadd457c516c99491386e63e96c5be7c1de030.svg" alt="f:T \times U \mapsto R"/>.</p>
<p>In the following example, a lambda expression is used to define a binary function that returns the element of a list at a specific index:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BiFunction</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">lst</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="mf">10.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">20.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">30.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">40.0f</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 20</span>
</pre></div>
</div>
</section>
<section id="operators">
<span id="fp-operators"></span><h3>Operators<a class="headerlink" href="#operators" title="Permalink to this heading">¶</a></h3>
<p>An <strong>operator</strong> is a particular case of a general-purpose functional interface, in which <strong>the arguments and the result are all of the same type</strong>. Operators are so common that Java defines specific interfaces for unary and binary operators:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The mathematical domain of an unary operator <img class="math" src="_images/math/5b7752c757e0b691a80ab8227eadb8a8389dc58a.svg" alt="f"/> is <img class="math" src="_images/math/fec335ba409f712c4b24c0c08fbe61c3beda5b46.svg" alt="f: T \mapsto T"/>, whereas the domain of a binary operator <img class="math" src="_images/math/5b7752c757e0b691a80ab8227eadb8a8389dc58a.svg" alt="f"/> is <img class="math" src="_images/math/fab0103cc6b8828c9c02584277884a7b743881a5.svg" alt="f: T \times T \mapsto T"/>.</p>
<p>As an example, the function computing the square of a double number is an unary operator that could be defined as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mf">5.0</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 25.0</span>
</pre></div>
</div>
<p>Similarly, for the absolute value:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">abs</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="o">-</span><span class="mf">14.0</span><span class="p">));</span><span class="w">    </span><span class="c1">// Displays: 14.0</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">PI</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 3.14159...</span>
</pre></div>
</div>
<p>The function computing the sum of two integers can be defined as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 37</span>
</pre></div>
</div>
<div class="remark admonition">
<p class="admonition-title">Remark</p>
<p>If you look at the <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/UnaryOperator.html">Java documentation</a>, unary and binary operators are actually defined as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BiFunction</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>This construction implies that a <code class="docutils literal notranslate"><span class="pre">UnaryOperator</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">BinaryOperator</span></code>) can be used as a placeholder for a <code class="docutils literal notranslate"><span class="pre">Function</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">BiFunction</span></code>). However, the construction is more involved, which explains why we preferred defining the operators as separate interfaces.</p>
</div>
</section>
<section id="composition">
<span id="id5"></span><h3>Composition<a class="headerlink" href="#composition" title="Permalink to this heading">¶</a></h3>
<p>In the context of general-purpose functional interfaces in Java, <strong>composition</strong> refers to the ability to combine multiple functions or operators to create more complex functions. It involves chaining functions together to perform a sequence of operations on data in a concise and expressive manner.</p>
<p>From a mathematical perspective, if we have a function <img class="math" src="_images/math/eb0b1455c1d1875148a975e448edebe532fc7048.svg" alt="f:X\mapsto Y"/> and a function <img class="math" src="_images/math/6d9761122885ee256b89752f9f7f1fda51b6484c.svg" alt="g:Y\mapsto Z"/>, their <a class="reference external" href="https://en.wikipedia.org/wiki/Function_composition">function composition</a> is the function <img class="math" src="_images/math/07c14b6fa90d53304c31c5e531671b324914da72.svg" alt="g\circ f:X\mapsto Z:x\mapsto g(f(x))"/>. In other words, the function <img class="math" src="_images/math/157ba5711de84b4c715a0478fd8ae440e596d96e.svg" alt="g"/> is applied to the result of applying the function <img class="math" src="_images/math/5b7752c757e0b691a80ab8227eadb8a8389dc58a.svg" alt="f"/> to <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/>.</p>
<p>In Java, the <code class="docutils literal notranslate"><span class="pre">Function</span></code> interface contains the default method <code class="docutils literal notranslate"><span class="pre">compose()</span></code> that can be used to construct a new function that represents its composition with another function. Thanks to the fact that <code class="docutils literal notranslate"><span class="pre">UnaryOperator</span></code> is a special case of a <code class="docutils literal notranslate"><span class="pre">Function</span></code>, composition is also compatible with operators.</p>
<p>Here is an example of composition:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">sqrt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span>
<span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="na">compose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">25</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 2.0, which corresponds to &quot;sqrt(25) / 2.5&quot;</span>
</pre></div>
</div>
<p>Evidently, composition is also available for binary functions and binary operators.</p>
</section>
<section id="predicates">
<span id="fp-predicate"></span><h3>Predicates<a class="headerlink" href="#predicates" title="Permalink to this heading">¶</a></h3>
<p>Predicates are another particular case of a general-purpose functional interface. They correspond to functions whose <strong>result type is a Boolean value</strong>. Unary predicates are frequently used to filter a collection of objects of a given type. The corresponding functional interface is defined as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pay attention to the fact that while the single abstract method of <code class="docutils literal notranslate"><span class="pre">Function</span></code> is named <code class="docutils literal notranslate"><span class="pre">call()</span></code>, the single abstract method of <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> is named <code class="docutils literal notranslate"><span class="pre">test()</span></code>.</p>
<p>For instance, a predicate that tests whether a list is empty could be defined and used as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">();</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">()));</span><span class="w">       </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="mi">10</span><span class="p">)));</span><span class="w">     </span><span class="c1">// Displays: false</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)));</span><span class="w"> </span><span class="c1">// Displays: false</span>
</pre></div>
</div>
<p>Here is another example to test whether a number if negative:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mf">10.0</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: false</span>
</pre></div>
</div>
<p>Note that there exists a binary version of the <code class="docutils literal notranslate"><span class="pre">Predicate&lt;T&gt;</span></code> unary functional interface, that is known as <code class="docutils literal notranslate"><span class="pre">BiPredicate&lt;T,U&gt;</span></code>.</p>
<p>In the same way functions and operators can be <a class="reference internal" href="#composition"><span class="std std-ref">composed</span></a>, the <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> and <code class="docutils literal notranslate"><span class="pre">BiPredicate</span></code> interfaces contain default methods that can be used to create new predicates from existing predicates. Those methods are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">and()</span></code> to define the logical conjunction of two predicates (i.e., <img class="math" src="_images/math/0ab741b64911e50c8ee837cfa56020bcc8dd2588.svg" alt="f \wedge g"/>),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">or()</span></code> to define the logical disjunction of two predicates (i.e., <img class="math" src="_images/math/673bd20baa017b57b62443223ed48a5412145351.svg" alt="f \vee g"/>), and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negate()</span></code> to define the logical negation of one predicate (i.e., <img class="math" src="_images/math/1f54c2dab66f5cdb846c8880e1bce9cb84c51c07.svg" alt="\neg f"/>).</p></li>
</ul>
<p>These operations can be used as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">and</span><span class="p">(</span><span class="n">q</span><span class="p">);</span><span class="w">    </span><span class="c1">// x &gt;= 0 &amp;&amp; x &lt;= 10</span>
<span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">or</span><span class="p">(</span><span class="n">q</span><span class="p">);</span><span class="w">     </span><span class="c1">// x &gt;= 0 || x &lt;= 10 &lt;=&gt; true</span>
<span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">negate</span><span class="p">();</span><span class="w">  </span><span class="c1">// x &lt; 0</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: false</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">   </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: false</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">   </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: true</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">   </span><span class="c1">// Displays: false</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: false</span>
</pre></div>
</div>
</section>
<section id="consumer">
<span id="fp-consumer"></span><h3>Consumer<a class="headerlink" href="#consumer" title="Permalink to this heading">¶</a></h3>
<p>Finally, a <strong>consumer</strong> is a general-purpose functional interface whose result type is void, i.e., that does not produce any value. It is defined as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">accept</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Consumers are typically encountered as the “terminal block” of a chain of functions. They can notably be used to print the result of a function, to write this result onto a file, or to store this result into another data structure.</p>
<p>For instance, the following code defines a consumer to print the result of a function:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="n">Consumer</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

<span class="n">c</span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 50</span>
</pre></div>
</div>
</section>
<section id="higher-order-functions">
<span id="id6"></span><h3>Higher-order functions<a class="headerlink" href="#higher-order-functions" title="Permalink to this heading">¶</a></h3>
<p>In Java, <strong>higher-order functions</strong> are methods that can <strong>accept other functions as arguments, return functions as results, or both</strong>. They treat the general-purpose functions seen above as first-class citizens, allowing these functions to be manipulated, passed around, and used as data.</p>
<p>The <a class="reference internal" href="#composition"><span class="std std-ref">composition of two functions</span></a> is an example of higher-order function: It takes two <code class="docutils literal notranslate"><span class="pre">Function</span></code> as arguments, and generates one <code class="docutils literal notranslate"><span class="pre">Function</span></code> as its result. We have already seen that Java already provides built-in support for function composition. However, we could have implemented composition by ourselves thanks to the expressiveness of lambda expressions. Indeed, the following program would have produced exactly the same result as the standard <code class="docutils literal notranslate"><span class="pre">compose()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Function</span></code> class:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">myCompose</span><span class="p">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span>
<span class="w">    </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">sqrt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myCompose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">);</span>

<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">25</span><span class="p">));</span><span class="w">  </span><span class="c1">// Display: 2.0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Composition is an example of higher-order function that <em>outputs</em> new functions. The standard Java classes also contains methods that take functions as their <em>inputs</em>. This is notably the case of the standard Java collections (most notably lists), that include several methods taking operators and predicates as arguments, for instance:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forEach(c)</span></code> applies a consumer to all the elements of the collection (this is part of the <code class="docutils literal notranslate"><span class="pre">Iterable&lt;E&gt;</span></code> interface),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">removeIf(p)</span></code> removes all of the elements of this collection that satisfy the given predicate (this is part of the <code class="docutils literal notranslate"><span class="pre">Collection&lt;E&gt;</span></code> interface), and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replaceAll(f)</span></code> replaces each element of the collection with the result of applying the operator to that element (this is specific to the <code class="docutils literal notranslate"><span class="pre">List&lt;T&gt;</span></code> interface).</p></li>
</ul>
<p>Here is a full example combining all these three methods:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the following list of integers: [ -3, -2, -1, 0, 1, 2, 3 ]</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">lst</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Multiply each integer by 10</span>
<span class="n">lst</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w">  </span><span class="c1">//  =&gt; [ -30, -20, -10, 0, 10, 20, 30 ]</span>

<span class="c1">// Remove negative integers</span>
<span class="n">lst</span><span class="p">.</span><span class="na">removeIf</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">     </span><span class="c1">//  =&gt; [ 0, 10, 20, 30 ]</span>

<span class="c1">// Print each element in the list</span>
<span class="n">lst</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</pre></div>
</div>
</section>
</section>
<section id="streams">
<h2>Streams<a class="headerlink" href="#streams" title="Permalink to this heading">¶</a></h2>
<p>In computer science, the term “stream” generally refers to a <strong>sequence of elements accessed one after the other</strong>, from the first to the last.</p>
<p>“Stream programming” in Java refers to the use of the <code class="docutils literal notranslate"><span class="pre">Stream</span></code> API, which was introduced in Java 8 through the <code class="docutils literal notranslate"><span class="pre">java.util.stream</span></code> package. Streams in Java provide a <strong>declarative way to perform computations on sequences of objects</strong>. They enable you to express complex data processing queries more concisely and efficiently than traditional iteration using loops.</p>
<p>Contrarily to Java collections such as <code class="docutils literal notranslate"><span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Set</span></code>, or <code class="docutils literal notranslate"><span class="pre">Map</span></code>, streams are <em>not</em> a data structure that stores elements in the RAM of the computer. They are a sequence of elements that originate from a data source. This data source can correspond to a Java collection (with elements in RAM), but it might as well correspond to objects that are progressively read from a database, from the filesystem, or from a network communication, possibly without ever being entirely stored inside the RAM of the computer.</p>
<p>In stream programming, the computations to be applied to the individual objects of a stream are declared as a <strong>chain of simple operations</strong> that is called a <strong>stream pipeline</strong>. Lambda expressions are in general used to concisely express these operations. A stream pipeline can be represented as follows:</p>
<a class="reference internal image-reference" href="_images/stream.svg"><img alt="Stream pipeline" class="align-center" src="_images/stream.svg" width="75%" /></a>
<p>In this figure:</p>
<ol class="arabic simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">Stream</span></code> object is first created from a collection of source objects of type <code class="docutils literal notranslate"><span class="pre">T</span></code> (the circles).</p></li>
<li><p>Zero or more intermediate operations are then successively applied to the individual objects that are part of the input <code class="docutils literal notranslate"><span class="pre">Stream</span></code> object, which generates a new output <code class="docutils literal notranslate"><span class="pre">Stream</span></code> object. These operations can change the content of the input objects, can create new objects (possibly of a different type), or can discard objects.</p></li>
<li><p>Finally, a terminal operation is applied to collect the results of the stream pipeline. In the figure above, the terminal operation consists in creating an output collection of objects of type <code class="docutils literal notranslate"><span class="pre">U</span></code> (the triangles), which may or may not be the same type as <code class="docutils literal notranslate"><span class="pre">T</span></code>. Other terminal operations are possible, such as counting the number of objects that are produced by the stream pipeline.</p></li>
</ol>
<section id="example-from-miles-to-kilometers">
<span id="stream-miles"></span><h3>Example: From miles to kilometers<a class="headerlink" href="#example-from-miles-to-kilometers" title="Permalink to this heading">¶</a></h3>
<p>To illustrate the benefits of stream programming, let us consider the task of converting a list of strings containing <a class="reference external" href="https://en.wikipedia.org/wiki/Mile">distances expressed in miles</a>, into a list of strings containing the distances expressed in kilometers, ignoring empty strings. For instance, the list containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;15&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>should be converted to the list (by definition, 1 mile equals 1609.344 meters):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;24.14016&quot;</span><span class="p">,</span> <span class="s2">&quot;5.6327043&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>Using the Java classes and methods for stream programming, this conversion can be translated very directly into a Java program:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Miles</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;15&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kilometers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miles</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w">      </span><span class="c1">// Skip empty strings</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Float</span><span class="p">.</span><span class="na">parseFloat</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w">  </span><span class="c1">// From string to float</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1609.344f</span><span class="p">)</span><span class="w">        </span><span class="c1">// From miles to meters</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000.0f</span><span class="p">)</span><span class="w">          </span><span class="c1">// From meters to kilometers</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">    </span><span class="c1">// From float to string</span>
<span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">  </span><span class="c1">// Construct the list</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This source code defines a stream pipeline that works as follows:</p>
<ol class="arabic simple">
<li><p>Get a stream from the input list of strings by calling <code class="docutils literal notranslate"><span class="pre">miles.stream()</span></code>.</p></li>
<li><p>Filter the input stream by removing the empty strings.</p></li>
<li><p>Parse the strings into floating-point numbers that contain the miles.</p></li>
<li><p>Convert miles into meters, then convert meters into kilometers.</p></li>
<li><p>Encode the floating-point numbers that contain the kilometers as strings.</p></li>
<li><p>Collect all the output strings into a list. This is the terminal operation.</p></li>
</ol>
<p>As can be seen, this syntax is very compact and intuitive because it adopts a <strong>declarative</strong> approach. The intermediate operations are expressed using functional-style programming thanks to the <a class="reference internal" href="#general-purpose-functional-interfaces"><span class="std std-ref">general-purpose functional interfaces</span></a> implemented with <a class="reference internal" href="#lambda-expressions"><span class="std std-ref">lambda expressions</span></a>. The intermediate operations are then <strong>chained</strong> together by using the output of one operation as the input of the next.</p>
<p>Importantly, the intermediate operations are not allowed to modify the data they operate on: Each intermediate operation creates a new stream, without modifying its own input stream. This is totally different from the <code class="docutils literal notranslate"><span class="pre">removeIf()</span></code> and <code class="docutils literal notranslate"><span class="pre">replaceAll()</span></code> methods of the <a class="reference internal" href="#higher-order-functions"><span class="std std-ref">higher-order function of the Java collections</span></a>, because the latter methods do modify their data source (i.e., the collection). In other words, stream pipelines have <strong>no side effects</strong> and <strong>do not modify their associated data sources</strong>, as long as the intermediate operations do not modify the state of the program (which is the main assumption of functional programming).</p>
<p>Stream pipelines are also <strong>lazy</strong>, which means that the intermediate operations are not evaluated until a terminal operation is encountered. In the code above, nothing is computed until the <code class="docutils literal notranslate"><span class="pre">collect()</span></code> method is called. This laziness allows for potential optimization by processing only the necessary elements (which is for instance useful if the data source corresponds to a large file), and by opening the path to the exploitation of multiple threads to separately process successive elements in a stream.</p>
</section>
<section id="java-streams">
<span id="id7"></span><h3>Java streams<a class="headerlink" href="#java-streams" title="Permalink to this heading">¶</a></h3>
<p>Stream programming in Java is built on the top of the following generic interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">java.util.stream</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Member methods</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This interface represents a stream of elements of type <code class="docutils literal notranslate"><span class="pre">T</span></code>. In our <a class="reference internal" href="#stream-miles"><span class="std std-ref">previous example</span></a>, the streams of string values are of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;String&gt;</span></code>, whereas the streams of floating-point values are of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;Float&gt;</span></code>. We could have made this more explicit by splitting the chain of the intermediate operations as distinct streams, which would have led to the equivalent (but less elegant) code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Stream</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Miles</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;15&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3.5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miles</span><span class="p">.</span><span class="na">stream</span><span class="p">();</span>
<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">l</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">());</span>
<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w">  </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Float</span><span class="p">::</span><span class="n">parseFloat</span><span class="p">);</span>
<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w">  </span><span class="n">s4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s3</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1609.344f</span><span class="p">);</span>
<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w">  </span><span class="n">s5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s4</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000.0f</span><span class="p">);</span>
<span class="w">        </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s5</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">String</span><span class="p">::</span><span class="n">valueOf</span><span class="p">);</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kilometers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s6</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Methods that work on streams belong to exactly one of the following three categories:</p>
<ul class="simple">
<li><p><strong>Source methods</strong>, which produce a stream of elements from a source (such as a collection, a file, a database,…),</p></li>
<li><p><strong>Intermediate methods</strong>, which transform the elements from an input stream to produce a new stream, and</p></li>
<li><p><strong>Terminal methods</strong>, which consume the elements in the stream (for instance, to print them on screen, to write them into a file, to store them in a Java collection, or to extract a single value out of them).</p></li>
</ul>
<p>In the miles-to-kilometers conversion, the <code class="docutils literal notranslate"><span class="pre">stream()</span></code> method is the source method, the <code class="docutils literal notranslate"><span class="pre">filter()</span></code> and <code class="docutils literal notranslate"><span class="pre">map()</span></code> methods are the intermediate methods, and the <code class="docutils literal notranslate"><span class="pre">collect()</span></code> method is the terminal method. Altogether, these methods define the stream pipeline.</p>
<p>Note that streams are not immutable, in the sense that when the elements of a stream are consumed by a terminal method, they disappear and the stream is then empty. In this respect, streams are similar to <a class="reference internal" href="part4.html#id7"><span class="std std-ref">iterators</span></a>, which are also modified as they are traversed.</p>
<div class="remark admonition">
<p class="admonition-title">Important remark</p>
<p>Note that <strong>you can only go once through the same stream pipeline</strong>. Once an element has been consumed, it is not possible anymore to access the same element again. For instance, this code will <em>not</em> work:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">).</span><span class="na">stream</span><span class="p">();</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">  </span><span class="c1">// OK</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">  </span><span class="c1">// =&gt; java.lang.IllegalStateException: stream has already been operated upon or closed</span>
</pre></div>
</div>
</div>
<p>The main source, intermediate, and terminal methods for stream programming in the Java standard library are now reviewed. Evidently, this list is by no way exhaustive. The full list of the features offered <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> is available in the online Java documentation: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html</a></p>
</section>
<section id="source-methods">
<span id="stream-source-methods"></span><h3>Source methods<a class="headerlink" href="#source-methods" title="Permalink to this heading">¶</a></h3>
<p>As already shown in the <a class="reference internal" href="#stream-miles"><span class="std std-ref">miles-to-kilometers example</span></a>, <strong>streams are frequently created out of one of the standard Java collections</strong> (such as <code class="docutils literal notranslate"><span class="pre">List</span></code> or <code class="docutils literal notranslate"><span class="pre">Set</span></code>). This stems from the fact that the <code class="docutils literal notranslate"><span class="pre">Collection&lt;E&gt;</span></code> interface contains the following method:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Other members</span>

<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">stream</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This source method provides a bridge between the world of Java collections and the world of Java streams. As already outlined before, the resulting stream uses the collection as its data source, but it never modifies this data source.</p>
<p>It is also possible to directly create a stream without using a collection. For instance, the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span> <span class="pre">empty()</span></code> static method creates an <strong>empty stream</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
</pre></div>
</div>
<p>A stream containing a <strong>predefined list of values</strong> can be constructed using the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span> <span class="pre">of(T...</span> <span class="pre">values)</span></code> static method. For instance, here is how to define a stream containing the vowels in French:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;i&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;u&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;y&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that the type <code class="docutils literal notranslate"><span class="pre">T</span></code> of the <code class="docutils literal notranslate"><span class="pre">of()</span></code> method can be a custom class. For instance, the following code is perfectly valid and creates a stream of complex objects whose class is <code class="docutils literal notranslate"><span class="pre">Account</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Account</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Account</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                   </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Account</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
</pre></div>
</div>
<p>Streams can also be <strong>constructed out of arrays</strong> using the <code class="docutils literal notranslate"><span class="pre">Arrays.stream()</span></code> static method. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Float</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Float</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0f</span><span class="w"> </span><span class="p">};</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<p>As far as files are concerned, the method <code class="docutils literal notranslate"><span class="pre">lines()</span></code> of the standard <code class="docutils literal notranslate"><span class="pre">BufferedReader</span></code> class returns a stream that scans the lines of a <a class="reference internal" href="part1.html#file-reader"><span class="std std-ref">Java reader</span></a>. This notably enables the creation of a <strong>stream that reads the lines of a file</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.BufferedReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Stream</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FileToStream</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">FileReader</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">&quot;somefile.txt&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">            </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="na">lines</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, because streams are lazy, it is possible to define <strong>streams that span an infinite number of elements</strong>. Obviously, an infinite sequence cannot be entirely computed before being accessed. The trick is to provide a seed element from which the sequence begins, together with an <a class="reference internal" href="#fp-operators"><span class="std std-ref">unary operator</span></a> that continuously updates the seed element to generate the next element in the sequence. The static method <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> of the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> interface is introduced to this end:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w">  </span><span class="nf">iterate</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">seed</span><span class="p">,</span><span class="w"> </span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
</pre></div>
</div>
<p>The stream created by <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> will successively produce the elements <code class="docutils literal notranslate"><span class="pre">seed</span></code>, <code class="docutils literal notranslate"><span class="pre">f(seed)</span></code>, <code class="docutils literal notranslate"><span class="pre">f(f(seed))</span></code>, <code class="docutils literal notranslate"><span class="pre">f(f(f(seed)))</span></code>… These successive elements are only computed on demand, i.e., when the next stream in the stream pipeline has to read a new element from its input stream. For instance, here is how to define the infinite stream of even positive numbers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">evenNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">iterate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>Infinite streams can also be created using the static method <code class="docutils literal notranslate"><span class="pre">generate()</span></code> of the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">get</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w">  </span><span class="nf">generate</span><span class="p">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">generate()</span></code> factory method is more generic than the <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> factory method, in the sense that <code class="docutils literal notranslate"><span class="pre">generate()</span></code> allows to manage a context that is richer than a single seed element using the members of the class implementing the <code class="docutils literal notranslate"><span class="pre">Supplier&lt;T&gt;</span></code> interface. Note that the <code class="docutils literal notranslate"><span class="pre">Supplier&lt;T&gt;</span></code> functional interface looks very similar to <code class="docutils literal notranslate"><span class="pre">Callable&lt;T&gt;</span></code>, except that its single abstract method is named <code class="docutils literal notranslate"><span class="pre">get()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">call()</span></code>. The example below illustrates how to create a supplier that generates a sequence of integers, starting from a seed value and successively adding a delta value, and how to use it to generate the sequence of negative odd numbers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">IntegerSequenceSupplier</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span>

<span class="w">    </span><span class="n">IntegerSequenceSupplier</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">seed</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">int</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seed</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">current</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">oddNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IntegerSequenceSupplier</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</pre></div>
</div>
<p>Evidently, the same stream could have been generated as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="p">.</span><span class="na">iterate</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="intermediate-methods">
<span id="stream-intermediate-methods"></span><h3>Intermediate methods<a class="headerlink" href="#intermediate-methods" title="Permalink to this heading">¶</a></h3>
<p>Once an instance of <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> is created using one of the <a class="reference internal" href="#stream-source-methods"><span class="std std-ref">source methods</span></a>, various intermediate operations can be applied to it.</p>
<section id="map">
<h4>Map<a class="headerlink" href="#map" title="Permalink to this heading">¶</a></h4>
<p>The method <code class="docutils literal notranslate"><span class="pre">map(Function&lt;T,R&gt;</span> <span class="pre">f)</span></code> is especially important and very frequently used, as it allows you to <strong>transform the elements of a stream</strong> to obtain a new one. The <code class="docutils literal notranslate"><span class="pre">map()</span></code> method is a <a class="reference internal" href="#higher-order-functions"><span class="std std-ref">higher-order function</span></a> that takes as argument an <a class="reference internal" href="#unary-function"><span class="std std-ref">unary function</span></a> <code class="docutils literal notranslate"><span class="pre">f</span></code> that is generally expressed as a <a class="reference internal" href="#lambda-expressions"><span class="std std-ref">lambda expression</span></a>. This unary function <code class="docutils literal notranslate"><span class="pre">f</span></code> is applied to the elements of the stream, which leads to the creation of an output stream. As an example, here is how to increment each value in a stream of integers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">incremented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// =&gt; [11, 21, 31, 41, 51]</span>
</pre></div>
</div>
<p>This is an example that uses an <a class="reference internal" href="#fp-operators"><span class="std std-ref">unary operator</span></a>, as both streams share the same data type (i.e., <code class="docutils literal notranslate"><span class="pre">Integer</span></code>). But the <code class="docutils literal notranslate"><span class="pre">map()</span></code> method also accept general functions that change the data type of the elements of the input stream. As an example, the following code creates a stream that provides the number of characters in each element of a stream of strings:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;Bonjour&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lengths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w">  </span><span class="c1">// This unary function goes from String to Integer</span>
<span class="c1">// Note that we could have written: stream.map(String::length);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">map()</span></code> method evidently supports user-defined classes. For instance, it is possible to extract the values from a stream of <code class="docutils literal notranslate"><span class="pre">Account</span></code> objects (as introduced in the <a class="reference internal" href="#stream-source-methods"><span class="std std-ref">previous section</span></a>) as a stream of integers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span><span class="w">  </span><span class="c1">// =&gt; [100, 200]</span>
<span class="c1">// Note that we could have written: accounts.map(Account::getValue);</span>
</pre></div>
</div>
<p>Interestingly, the <code class="docutils literal notranslate"><span class="pre">map()</span></code> method can also be used to create objects by calling their constructor on the elements from the input stream. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="c1">// Note that we could have written: values.map(Account::new);</span>
</pre></div>
</div>
</section>
<section id="filter">
<h4>Filter<a class="headerlink" href="#filter" title="Permalink to this heading">¶</a></h4>
<p>Another significant method on streams is <code class="docutils literal notranslate"><span class="pre">filter(Predicate&lt;T&gt;</span> <span class="pre">p)</span></code>. This method is a higher-order function that takes as a argument an <a class="reference internal" href="#fp-predicate"><span class="std std-ref">unary predicate</span></a> <code class="docutils literal notranslate"><span class="pre">p</span></code>, and that creates a new stream that <strong>only contains the objects from the input stream that verify the predicate</strong>. As an example, here is how to filter a stream of integers to keep only the values that are integer multiples of 4:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// [20, 40]</span>
</pre></div>
</div>
</section>
<section id="other-intermediate-methods">
<h4>Other intermediate methods<a class="headerlink" href="#other-intermediate-methods" title="Permalink to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code> methods are extremely important higher-order functions that also exist in Python to manipulate lists. Besides <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code>, let us also highlight the existence of the following intermediate methods:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sorted()</span></code> returns a stream containing the same elements as the one to which it is applied, but <strong>sorted in ascending natural order</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">sorted</span><span class="p">();</span><span class="w">  </span><span class="c1">// =&gt; [10, 20, 30, 40, 50]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sorted(Comparator&lt;T&gt;</span> <span class="pre">c)</span></code> returns a stream containing the same elements as the one to which it is applied, but <strong>sorted by delegation to a comparator</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">800</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="na">sorted</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">getValue</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span>
<span class="c1">// =&gt; [ Account(100), Account(200), Account(500), Account(800) ]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip(long</span> <span class="pre">n)</span></code> <strong>ignores the first “n” elements</strong> from the input stream, and returns the stream of the remaining elements:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">skipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// =&gt; [40, 50]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">limit(long</span> <span class="pre">l)</span></code> returns a stream containing the same elements as the stream to which it is applied, but <strong>truncated to have at most “l” elements</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// =&gt; [10, 20]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">limit()</span></code> method can notably be used to truncate infinite streams into a finite stream.</p>
</li>
</ul>
</section>
</section>
<section id="terminal-methods">
<h3>Terminal methods<a class="headerlink" href="#terminal-methods" title="Permalink to this heading">¶</a></h3>
<p>In a stream pipeline, the last operation is usually an operation that returns some result that is not a stream: This last operation <strong>gets the data out of the stream</strong>. It is possible to distinguish between three different cases:</p>
<ul class="simple">
<li><p>Stream pipelines whose terminal method does something with each individual element of the stream (<strong>consumer methods</strong>),</p></li>
<li><p>Stream pipelines whose terminal method creates a Java data structure to store the elements of the stream (<strong>collector methods</strong>), and</p></li>
<li><p>Stream pipelines whose terminal method extracts a single value out of the stream (<strong>reduction methods</strong>).</p></li>
</ul>
<section id="consumer-methods">
<span id="stream-foreach"></span><h4>Consumer methods<a class="headerlink" href="#consumer-methods" title="Permalink to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> terminal method of the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> interface is a higher-order function that takes as input a <a class="reference internal" href="#fp-consumer"><span class="std std-ref">consumer function</span></a> <code class="docutils literal notranslate"><span class="pre">c</span></code>. This method applies the <code class="docutils literal notranslate"><span class="pre">c</span></code> function to all the elements of the stream. This is similar to the <code class="docutils literal notranslate"><span class="pre">map()</span></code> <a class="reference internal" href="#stream-intermediate-methods"><span class="std std-ref">intermediate method</span></a>, but since consumers do not produce an output value, the <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> operation yields no result.</p>
<p>Typical usages of <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> include printing the content of the stream, writing it to a file, sending it over a network connection, or saving it to a database. A very common pattern consists in calling the standard <code class="docutils literal notranslate"><span class="pre">System.out.println()</span></code> method on each element in the stream:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">);</span>
<span class="n">stream</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
</pre></div>
</div>
<p>By virtue of the <a class="reference internal" href="#lambda-expressions"><span class="std std-ref">method reference</span></a> construction, the code above is often shortened as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">);</span>
<span class="n">stream</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="collector-methods">
<span id="stream-collector-methods"></span><h4>Collector methods<a class="headerlink" href="#collector-methods" title="Permalink to this heading">¶</a></h4>
<p>Another possibility for a terminal method consists in collecting the elements of the stream into a Java data structure. This is the role of the <code class="docutils literal notranslate"><span class="pre">collect()</span></code> method that is available in the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> interface, and takes as argument an object that implements the <code class="docutils literal notranslate"><span class="pre">Collector</span></code> interface.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Collector</span></code> interface represents a very generic construction that is quite complex to master. Fortunately, Java proposes a set of predefined, concrete implementations of the <code class="docutils literal notranslate"><span class="pre">Collector</span></code> interface that can be directly instantiated using the static methods of the <code class="docutils literal notranslate"><span class="pre">java.util.stream.Collectors</span></code> class: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html</a></p>
<p>In what follows, the return type of the static methods of <code class="docutils literal notranslate"><span class="pre">Collectors</span></code> is never shown, as it tends to be complicated and understanding it is not necessary for the use of the predefined collectors. In practice, the result of the static methods is always passed directly to the <code class="docutils literal notranslate"><span class="pre">collect()</span></code> method of a stream.</p>
<p>Here are some of the most useful predefined collectors to create Java containers from streams:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.toList()</span></code> returns a collector that <strong>stores the elements of the stream into a list</strong>. If the stream is of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code>, the output list will be of type <code class="docutils literal notranslate"><span class="pre">List&lt;T&gt;</span></code>. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">  </span><span class="c1">// =&gt; List: [10, 20, 30]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.toSet()</span></code> returns a collector that <strong>stores the elements of the stream into a set</strong>. If the stream is of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code>, the output list will be of type <code class="docutils literal notranslate"><span class="pre">Set&lt;T&gt;</span></code>. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toSet</span><span class="p">());</span><span class="w">  </span><span class="c1">// =&gt; Set: {10, 20}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.toMap(Function&lt;T,K&gt;</span> <span class="pre">keyMapper,</span> <span class="pre">Function&lt;T,U&gt;</span> <span class="pre">valueMapper)</span></code> returns a collector that <strong>stores the elements of the stream into an associative array</strong> (i.e., a dictionary). The function <code class="docutils literal notranslate"><span class="pre">keyMapper</span></code> is used to generate the key corresponding to each element in the stream, and the function <code class="docutils literal notranslate"><span class="pre">valueMapper</span></code> is used to generate the value corresponding to each element. If the stream is of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code>, the output list will be of type <code class="docutils literal notranslate"><span class="pre">Map&lt;K,V&gt;</span></code>. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="s">&quot;Dupont&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">                                     </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="s">&quot;Dupond&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">));</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nameToValue</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">accounts</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span>
<span class="w">                                      </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="na">getValue</span><span class="p">()));</span>
<span class="c1">// The associative array will contain: { &quot;Dupont&quot; : 100, &quot;Dupond&quot; : 200 }</span>
</pre></div>
</div>
</li>
</ul>
<p>If the stream is of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;String&gt;</span></code>, the following predefined containers can be used to combine the successive strings from the stream:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.joining()</span></code> returns a collector that <strong>concatenates the individual strings from a stream of strings</strong>. For instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">);</span>
<span class="n">String</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">joined</span><span class="p">);</span><span class="w">  </span><span class="c1">// Displays: onetwothree</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.joining(String</span> <span class="pre">delimiter)</span></code> works similarly to <code class="docutils literal notranslate"><span class="pre">Collectors.joining()</span></code>, but it adds the <code class="docutils literal notranslate"><span class="pre">delimiter</span></code> between each individual string:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">);</span>
<span class="n">String</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">joined</span><span class="p">);</span><span class="w">  </span><span class="c1">// Displays: one, two, three</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Collectors.joining(String</span> <span class="pre">delimiter,</span> <span class="pre">String</span> <span class="pre">prefix,</span> <span class="pre">String</span> <span class="pre">suffix)</span></code> works similarly to <code class="docutils literal notranslate"><span class="pre">Collectors.joining(delimiter)</span></code>, but it also add a prefix and a suffix:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">);</span>
<span class="n">String</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{ &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; }&quot;</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">joined</span><span class="p">);</span><span class="w">  </span><span class="c1">// Displays: {one, two, three}</span>
</pre></div>
</div>
</li>
</ul>
<p>Finally, note that the <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> interface also contains the <code class="docutils literal notranslate"><span class="pre">toArray()</span></code> collector method. This method create an array of <code class="docutils literal notranslate"><span class="pre">Object</span></code> from a stream:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">toArray</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span><span class="w">  </span><span class="c1">// Displays: 100</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span><span class="w">  </span><span class="c1">// Displays: 200</span>
</pre></div>
</div>
<p>The downside of <code class="docutils literal notranslate"><span class="pre">toArray()</span></code> is that the generic type <code class="docutils literal notranslate"><span class="pre">T</span></code> is lost and replaced by type <code class="docutils literal notranslate"><span class="pre">Object</span></code>, i.e., the root of the class hierarchy. This opens a huge risk of <a class="reference internal" href="part2.html#generics"><span class="std std-ref">bad casts</span></a>. It is therefore generally better to use the predefined collectors instead of <code class="docutils literal notranslate"><span class="pre">toArray()</span></code>.</p>
</section>
<section id="reduction-methods">
<h4>Reduction methods<a class="headerlink" href="#reduction-methods" title="Permalink to this heading">¶</a></h4>
<p>As explained above, consumer methods apply an operation to each element in a stream, while collector methods create a new Java data structure that combines all the elements of a stream. This contrasts with reduction methods, that produce <strong>one single value from the entire stream</strong>.</p>
<p>The simplest reduction method consists in <strong>counting the number of elements</strong> in the stream. The <code class="docutils literal notranslate"><span class="pre">count()</span></code> method can be used to this end:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">stream</span><span class="p">.</span><span class="na">count</span><span class="p">());</span><span class="w">  </span><span class="c1">// Displays: 3</span>
</pre></div>
</div>
<p>Reduction methods also exist to test to which extent the elements of a stream <strong>satisfy a common logical condition</strong> expressed as a <a class="reference internal" href="#fp-predicate"><span class="std std-ref">predicate</span></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">allMatch(Predicate&lt;T&gt;</span> <span class="pre">p)</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if and only if all the individual elements in a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> satisfy the predicate <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anyMatch(Predicate&lt;T&gt;</span> <span class="pre">p)</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if and only if at least one of individual elements in a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> satisfies the predicate <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noneMatch(Predicate&lt;T&gt;</span> <span class="pre">p)</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if and only if none of the individual elements in a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> satisfies the predicate <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
</ul>
<p>For instance, the following code tests whether we are given a stream of even integers:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">).</span><span class="na">allMatch</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: true</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="na">allMatch</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: false</span>
</pre></div>
</div>
<p>The most generic reduction method is offered by the <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> method. There exists several variants of this method, but the most commonly used is <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">reduce(T</span> <span class="pre">identity,</span> <span class="pre">BinaryOperator&lt;T&gt;</span> <span class="pre">accumulator)</span></code>: This method returns the value resulting from <strong>successive application of the binary operator</strong> <code class="docutils literal notranslate"><span class="pre">accumulator</span></code> to the initial value <code class="docutils literal notranslate"><span class="pre">identity</span></code> and to the successive elements of the stream. If the stream is empty, this method simply returns <code class="docutils literal notranslate"><span class="pre">identity</span></code>.</p>
<p>As an example, let us consider the task of computing the <strong>sum of the values in a stream of integers</strong>. Zero being the identity element for the addition, the <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> method could be used as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">stream</span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 15</span>
</pre></div>
</div>
<p>Here are the steps of the computation that is carried on by the <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> method:</p>
<ol class="arabic simple">
<li><p>It initializes a temporary variable whose initial value is given by <code class="docutils literal notranslate"><span class="pre">identity</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">0</span></code> in this case).</p></li>
<li><p>It reads the next element from the stream, for instance <code class="docutils literal notranslate"><span class="pre">2</span></code>. Using the lambda expression for <code class="docutils literal notranslate"><span class="pre">accumulator</span></code>, it computes <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">+</span> <span class="pre">2</span></code> (where <code class="docutils literal notranslate"><span class="pre">0</span></code> is the temporary variable), and stores the result <code class="docutils literal notranslate"><span class="pre">2</span></code> in the temporary variable.</p></li>
<li><p>It reads the next element, for instance <code class="docutils literal notranslate"><span class="pre">5</span></code>. According to <code class="docutils literal notranslate"><span class="pre">accumulator</span></code>, it computes <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">5</span></code> (where <code class="docutils literal notranslate"><span class="pre">2</span></code> is the temporary variable), and stores <code class="docutils literal notranslate"><span class="pre">7</span></code> in the temporary variable.</p></li>
<li><p>It reads the final element, for instance <code class="docutils literal notranslate"><span class="pre">8</span></code>. According to <code class="docutils literal notranslate"><span class="pre">accumulator</span></code>, it computes <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">+</span> <span class="pre">8</span></code> (where <code class="docutils literal notranslate"><span class="pre">7</span></code> is the temporary variable), and stores <code class="docutils literal notranslate"><span class="pre">15</span></code> in the temporary variable, which is at last returned to the caller.</p></li>
</ol>
<p>As another example, here is how to compute the <strong>product of the values in a stream of double precision numbers</strong>, for which <code class="docutils literal notranslate"><span class="pre">1.0</span></code> is the identity value:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.5</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">stream</span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: -11.0</span>
</pre></div>
</div>
<div class="remark admonition">
<p class="admonition-title">Remark</p>
<p>Pay attention to the fact that during a reduction, the order in which the binary operator <code class="docutils literal notranslate"><span class="pre">accumulator</span></code> is applied to the various elements is not specified (for instance because parallelism can possibly be used to speed up some computation), so this operator must be associative.</p>
</div>
</section>
</section>
<section id="about-laziness">
<h3>About laziness<a class="headerlink" href="#about-laziness" title="Permalink to this heading">¶</a></h3>
<p>Let us consider the following code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
</pre></div>
</div>
<p>You could think that the code does the following:</p>
<ol class="arabic simple">
<li><p>A stream with elements <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">4</span></code>, and <code class="docutils literal notranslate"><span class="pre">5</span></code> is created.</p></li>
<li><p>The lambda expression <code class="code docutils literal notranslate"><span class="pre">i</span> <span class="pre">-&gt;</span> <span class="pre">{</span> <span class="pre">System.out.println(i);</span> <span class="pre">return</span> <span class="pre">i</span> <span class="pre">+</span> <span class="pre">1;</span> <span class="pre">}</span></code> is applied to each element.</p></li>
<li><p>The console display the lines <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">4</span></code>, and <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></li>
<li><p>A new stream containing <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">4</span></code>, <code class="docutils literal notranslate"><span class="pre">5</span></code>, and <code class="docutils literal notranslate"><span class="pre">6</span></code> is returned.</p></li>
</ol>
<p>However, this is wrong! The code above does not print anything. Indeed, as <a class="reference internal" href="#stream-miles"><span class="std std-ref">written above</span></a>, <strong>streams are lazy</strong>. The operations are only executed if the result is needed, for example as in:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="na">toArray</span><span class="p">();</span><span class="w">  </span><span class="c1">// &lt;- here, all the elements of the stream are needed</span>
</pre></div>
</div>
<p>This code will actually print all the elements onto the console! Now, let us consider the following example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">toArray</span><span class="p">();</span><span class="w">  </span><span class="c1">// &lt;- here, only the two first elements of the stream are needed</span>
</pre></div>
</div>
<p>This code will only print <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> onto the console! This is because the <code class="docutils literal notranslate"><span class="pre">limit()</span></code> method stops further processing of its input stream as soon as the maximum number of elements is reached. This also explains why <a class="reference internal" href="#stream-source-methods"><span class="std std-ref">infinite streams</span></a> can be represented using Java streams.</p>
<p>It is also interesting to understand that the progression over interdependent streams is <strong>interleaved</strong>. This can be seen in the following example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;a: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="n">s2</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;b: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">));</span>
</pre></div>
</div>
<p>This example prints the following sequence:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>a: 1
b: 2
a: 2
b: 3
a: 3
b: 4
</pre></div>
</div>
<p>This is because the reading of streams <code class="docutils literal notranslate"><span class="pre">s1</span></code> and <code class="docutils literal notranslate"><span class="pre">s2</span></code> is interleaved. Here are the steps of the evaluation:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forEach()</span></code> needs the first element of <code class="docutils literal notranslate"><span class="pre">s2</span></code>. To obtain this first element, <code class="docutils literal notranslate"><span class="pre">map()</span></code> is executed on the first element of <code class="docutils literal notranslate"><span class="pre">s1</span></code>. So, <code class="docutils literal notranslate"><span class="pre">a:</span> <span class="pre">1</span></code> is printed, then <code class="docutils literal notranslate"><span class="pre">b:</span> <span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forEach()</span></code> needs the second element of <code class="docutils literal notranslate"><span class="pre">s2</span></code>. To obtain this second element, <code class="docutils literal notranslate"><span class="pre">map()</span></code> is executed on the second element of <code class="docutils literal notranslate"><span class="pre">s1</span></code>. So, <code class="docutils literal notranslate"><span class="pre">a:</span> <span class="pre">2</span></code> is printed, then <code class="docutils literal notranslate"><span class="pre">b:</span> <span class="pre">3</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forEach()</span></code> needs the third and last element of <code class="docutils literal notranslate"><span class="pre">s3</span></code>. To obtain this last element, <code class="docutils literal notranslate"><span class="pre">map()</span></code> is executed on the last element of <code class="docutils literal notranslate"><span class="pre">s1</span></code>. So, <code class="docutils literal notranslate"><span class="pre">a:</span> <span class="pre">3</span></code> is printed, then <code class="docutils literal notranslate"><span class="pre">b:</span> <span class="pre">4</span></code>.</p></li>
</ol>
<p>Finally, because streams are lazy, they can be also used in situations <strong>where it is not known in advance how long the stream is</strong>. For instance, here is a sample code that prints all the lines of a text file in upper case, by using the <code class="docutils literal notranslate"><span class="pre">lines()</span></code> <a class="reference internal" href="#stream-source-methods"><span class="std std-ref">source method of a reader</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">FileReader</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">&quot;somefile.txt&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="na">lines</span><span class="p">();</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">String</span><span class="p">::</span><span class="n">toUpperCase</span><span class="p">).</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This code does <em>not</em> read the entire file, then print it. That would use a lot of memory if the file is very big! Instead, this code reads a new line from the file <em>only when it is needed</em>. In other words, the code reads the first line, prints it, reads the second line, prints it, and so on.</p>
</section>
<section id="specialized-streams">
<h3>Specialized streams<a class="headerlink" href="#specialized-streams" title="Permalink to this heading">¶</a></h3>
<p>So far, we have only been considering the generic interface <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code>. For performance reasons, there also exist <strong>specialized interfaces representing streams of three primitive types</strong>, namely:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IntStream</span></code> for streams of <code class="docutils literal notranslate"><span class="pre">int</span></code> numbers: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LongStream</span></code> for streams of <code class="docutils literal notranslate"><span class="pre">long</span></code> numbers: <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/LongStream.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/LongStream.html</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> for streams of double precision numbers (i.e., for the primitive type <code class="docutils literal notranslate"><span class="pre">double</span></code>): <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/DoubleStream.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/DoubleStream.html</a></p></li>
</ul>
<p>For instance, a stream of <code class="docutils literal notranslate"><span class="pre">int</span></code> numbers can either be represented as a generic stream of type <code class="docutils literal notranslate"><span class="pre">Stream&lt;Integer&gt;</span></code> (in which each element is an object of type <code class="docutils literal notranslate"><span class="pre">Integer</span></code>), or as a specialized stream of type <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> (in which each element is internally represented as an <code class="docutils literal notranslate"><span class="pre">int</span></code> primitive value). Specialized streams are in general more efficient than generic streams, as they avoid the creation of objects, and should be preferred wherever possible when performance optimization or memory usage is important.</p>
<p>Note that there is no specialized streams for the other primitive types: It is recommended to use <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> to store <code class="docutils literal notranslate"><span class="pre">short</span></code>, <code class="docutils literal notranslate"><span class="pre">char</span></code>, <code class="docutils literal notranslate"><span class="pre">byte</span></code>, and <code class="docutils literal notranslate"><span class="pre">boolean</span></code> values. As far as <code class="docutils literal notranslate"><span class="pre">float</span></code> are concerned, it is recommended to use <code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> if a specialized stream is preferable.</p>
<p>The <strong>conversions between generic streams and specialized streams</strong> are ruled as follows:</p>
<ul class="simple">
<li><p>A specialized <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> can be constructed from a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> using the <code class="docutils literal notranslate"><span class="pre">mapToInt()</span></code> method of the generic stream.</p></li>
<li><p>A specialized <code class="docutils literal notranslate"><span class="pre">LongStream</span></code> can be constructed from a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> using the <code class="docutils literal notranslate"><span class="pre">mapToLong()</span></code> method of the generic stream.</p></li>
<li><p>A specialized <code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> can be constructed from a <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> using the <code class="docutils literal notranslate"><span class="pre">mapToDouble()</span></code> method of the generic stream.</p></li>
<li><p>Conversely, a generic <code class="docutils literal notranslate"><span class="pre">Stream&lt;T&gt;</span></code> can be constructed from an <code class="docutils literal notranslate"><span class="pre">IntStream</span></code>, from a <code class="docutils literal notranslate"><span class="pre">LongStream</span></code>, or from an <code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> using the <code class="docutils literal notranslate"><span class="pre">mapToObj()</span></code> method of the specialized stream.</p></li>
</ul>
<p>For instance, the <a class="reference internal" href="#stream-miles"><span class="std std-ref">conversion between miles and kilometers</span></a> could have been implemented as follows using the specialized <code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> (the two modified lines are highlighted by asterisks):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kilometers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miles</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w">                </span><span class="c1">// Skip empty strings</span>
<span class="w">    </span><span class="p">.</span><span class="na">mapToDouble</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">parseDouble</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w">  </span><span class="c1">// (*) From string to double</span>
<span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1609.344</span><span class="p">)</span><span class="w">                   </span><span class="c1">// From miles to meters</span>
<span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">)</span><span class="w">                     </span><span class="c1">// From meters to kilometers</span>
<span class="w">    </span><span class="p">.</span><span class="na">mapToObj</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">         </span><span class="c1">// (*) From double to string</span>
<span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">            </span><span class="c1">// Construct the list</span>
</pre></div>
</div>
<p>As another example, here is how to create an <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> from the elements of a stream of <code class="docutils literal notranslate"><span class="pre">Account</span></code> objects (as introduced in the <a class="reference internal" href="#stream-source-methods"><span class="std std-ref">previous section</span></a>):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Account</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
<span class="n">IntStream</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="na">mapToInt</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span>
<span class="n">values</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
</pre></div>
</div>
<p>It is also worth noticing that <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> and <code class="docutils literal notranslate"><span class="pre">LongStream</span></code> have two interesting static methods <code class="docutils literal notranslate"><span class="pre">range()</span></code> and <code class="docutils literal notranslate"><span class="pre">rangeClosed()</span></code> that can be used to easily create a <strong>stream that represents an interval of integers</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">IntStream</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntStream</span><span class="p">.</span><span class="na">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">        </span><span class="c1">// =&gt; [-3, -2, -1, 0, 1, 2]</span>
<span class="n">IntStream</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntStream</span><span class="p">.</span><span class="na">rangeClosed</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// =&gt; [-3, -2, -1, 0, 1, 2, 3]</span>
</pre></div>
</div>
<p>As can be seen in this example, these two methods only differ with respect to the fact that the last integer in the range is included or not.</p>
<p>Finally, besides their interest for optimization, the specialized streams also provide convenient <a class="reference internal" href="#stream-collector-methods"><span class="std std-ref">collector methods</span></a> that <strong>directly return Java arrays from a stream</strong>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">toArray()</span></code> method of <code class="docutils literal notranslate"><span class="pre">IntStream</span></code> creates a <code class="docutils literal notranslate"><span class="pre">int[]</span></code> value,</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">toArray()</span></code> method of <code class="docutils literal notranslate"><span class="pre">LongStream</span></code> creates a <code class="docutils literal notranslate"><span class="pre">long[]</span></code> value, and</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">toArray()</span></code> method of <code class="docutils literal notranslate"><span class="pre">DoubleStream</span></code> creates a <code class="docutils literal notranslate"><span class="pre">double[]</span></code> value.</p></li>
</ul>
<p>Here is an example of this feature:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">IntStream</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntStream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>
<section id="programming-without-side-effects">
<h2>Programming without side effects<a class="headerlink" href="#programming-without-side-effects" title="Permalink to this heading">¶</a></h2>
<section id="side-effects">
<h3>Side effects<a class="headerlink" href="#side-effects" title="Permalink to this heading">¶</a></h3>
<p>Remember that <a class="reference internal" href="#lambda-expressions"><span class="std std-ref">lambda expressions</span></a> in Java are implemented as anonymous inner classes. As a consequence, they are allowed to access members of the outer class:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.function.Function</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SideEffect</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createAddition</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">sum</span><span class="o">++</span><span class="p">;</span><span class="w">           </span><span class="c1">// Side effect!</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SideEffect</span><span class="p">().</span><span class="na">createAddition</span><span class="p">();</span>

<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">add</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 4</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">add</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">  </span><span class="c1">// Displays: 5</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is an extremely counter-intuitive behavior: Any developer that has not implemented the <code class="docutils literal notranslate"><span class="pre">createAddition()</span></code> method would expect that multiple applications of the same <code class="docutils literal notranslate"><span class="pre">Function</span></code> should always give the same result. In mathematics, we indeed expect that a function always gives the same result for the same argument!</p>
<p>For this reason, this kind of code should be avoided, even if it fully respects the Java syntax. <strong>A good function should have no side effect</strong>. A function should never change existing objects and variables. The code of a function or method is easier to understand if the result <em>only</em> depends on its arguments. Furthermore, a function that has side effect can result in severe concurrency issues if executed in a multithreaded context.</p>
</section>
<section id="immutable-objects">
<h3>Immutable objects<a class="headerlink" href="#immutable-objects" title="Permalink to this heading">¶</a></h3>
<p>In order to enforce the absence of side effects and to ensure thread safety, functional programming promotes the use of <strong>immutable objects</strong>. Immutable objects are objects whose state cannot be changed after they are created.</p>
<p>For instance, <strong>strings in Java are immutable</strong>. Once a <code class="docutils literal notranslate"><span class="pre">String</span></code> object is created, its value cannot be changed. Operations that appear to modify a string actually create a new <code class="docutils literal notranslate"><span class="pre">String</span></code> object.</p>
<p>On the other hand, primitive types in Java <em>are</em> mutable (for instance, you can change the value of a <code class="docutils literal notranslate"><span class="pre">int</span></code> variable after its declaration). However, the <strong>wrapper classes associated with primitive types are immutable</strong>. Indeed, classes like <code class="docutils literal notranslate"><span class="pre">Integer</span></code>, <code class="docutils literal notranslate"><span class="pre">Long</span></code>, <code class="docutils literal notranslate"><span class="pre">Float</span></code>, <code class="docutils literal notranslate"><span class="pre">Double</span></code>, <code class="docutils literal notranslate"><span class="pre">Byte</span></code>, <code class="docutils literal notranslate"><span class="pre">Short</span></code>, <code class="docutils literal notranslate"><span class="pre">Character</span></code>, or <code class="docutils literal notranslate"><span class="pre">Boolean</span></code>, which are used to wrap the primitive data types, are all immutable: The primitive value they store can never be changed after their construction. In the same vein, <a class="reference internal" href="part1.html#enumerations"><span class="std std-ref">Java enums</span></a> are implicitly immutable. Once the enum constants are created, their values cannot be modified.</p>
</section>
<section id="an-immutable-list">
<h3>An immutable list<a class="headerlink" href="#an-immutable-list" title="Permalink to this heading">¶</a></h3>
<p>We already know that the standard <code class="docutils literal notranslate"><span class="pre">List&lt;T&gt;</span></code> interface offers the <code class="docutils literal notranslate"><span class="pre">removeIf()</span></code> and <code class="docutils literal notranslate"><span class="pre">replaceAll()</span></code> methods to apply <a class="reference internal" href="#higher-order-functions"><span class="std std-ref">higher-order functions</span></a> onto their content. Because of the presence such methods, the standard Java lists are mutable objects, which contrasts with the philosophy of functional programming. Can we design a list without side effect, in a way that is similar to streams? The answer is “yes”, and this section explains how to <strong>create an immutable generic list</strong>.</p>
<p>The basic idea is similar to the <a class="reference internal" href="part4.html#linked-stack-adt"><span class="std std-ref">linked list abstract data structure</span></a>. It consists in creating the following class hierarchy:</p>
<a class="reference internal image-reference" href="_images/immutable-list-1.svg"><img alt="Class hierarchy to create an immutable list" class="align-center" src="_images/immutable-list-1.svg" width="50%" /></a>
<p>In this hierarchy:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code> is a generic type that must correspond to an immutable type, such as <code class="docutils literal notranslate"><span class="pre">Integer</span></code> or <code class="docutils literal notranslate"><span class="pre">Float</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Nil&lt;T&gt;</span></code> represents the end of an immutable list. This data structure contains no information, it is simply a terminal node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cons&lt;T&gt;</span></code> stores a non-empty value of the list, together with a link to the next element in the list. The name <code class="docutils literal notranslate"><span class="pre">Cons</span></code> originates from the fundamental <code class="docutils literal notranslate"><span class="pre">cons</span></code> function that is used in most dialects of the Lisp programming language to <a class="reference external" href="https://en.wikipedia.org/wiki/Cons">construct memory objects</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ImmutableList&lt;T&gt;</span></code> is an <a class="reference internal" href="part2.html#interfaces"><span class="std std-ref">interface</span></a> that represents a reference to the immutable list itself.</p></li>
</ul>
<p>This class hierarchy would store the immutable list containing the 10, 20, and 30 integer values as follows:</p>
<a class="reference internal image-reference" href="_images/immutable-list-2.svg"><img alt="An immutable list of integers" class="align-center" src="_images/immutable-list-2.svg" width="80%" /></a>
<p>Here is the corresponding Java code to define this hierarchy:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Nil</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Nil</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cons</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Cons</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">,</span>
<span class="w">                </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And our sample immutable list containing 10, 20, and 30 can then be constructed from its last element to its first element:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the terminal node that represent the empty list</span>
<span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Nil</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">();</span>

<span class="c1">// Create the node containing &quot;30&quot; that represents the list: [ 30 ]</span>
<span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cons</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p">);</span>

<span class="c1">// Create the node containing &quot;20&quot; that represents the list: [ 20, 30 ]</span>
<span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cons</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">list1</span><span class="p">);</span>

<span class="c1">// Create the node containing &quot;10&quot; that represents the list: [ 10, 20, 30 ]</span>
<span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">myList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cons</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">list2</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">list1</span></code> and <code class="docutils literal notranslate"><span class="pre">list2</span></code> are always the same lists: We can add an element to the head of a list without changing the tail of the list. This demonstrates that <strong>this data structure is immutable</strong>. It cannot be changed after creation.</p>
</section>
<section id="consuming-an-immutable-list">
<h3>Consuming an immutable list<a class="headerlink" href="#consuming-an-immutable-list" title="Permalink to this heading">¶</a></h3>
<p>Because our <code class="docutils literal notranslate"><span class="pre">ImmutableList&lt;T&gt;</span></code> data structure is immutable, we do not provide a public access to the values it stores.</p>
<p>If we want to execute an operation on each element of the immutable list according to the functional programming paradigm, we would use a <a class="reference internal" href="#fp-consumer"><span class="std std-ref">consumer</span></a>. A consumer can be applied to our immutable list by adding a <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> higher-order method in the <code class="docutils literal notranslate"><span class="pre">ImmutableList&lt;T&gt;</span></code> interface, which mimics <a class="reference internal" href="#stream-foreach"><span class="std std-ref">streams</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">forEach</span><span class="p">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> in the concrete classes <code class="docutils literal notranslate"><span class="pre">Nil&lt;T&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">Cons&lt;T&gt;</span></code> follows a <a class="reference internal" href="part4.html#recursivity"><span class="std std-ref">recursive algorithm</span></a>. The base case of the recursion corresponds to the handling of an empty list, which simply does nothing:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Nil</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">forEach</span><span class="p">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As far as a non-empty node is concerned, the concrete class first applies the consumer to the value that it stores, then it forwards the consumer to the next item in the list:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cons</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">forEach</span><span class="p">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">        </span><span class="n">next</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">consumer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Thanks to this <code class="docutils literal notranslate"><span class="pre">forEach()</span></code> method, it becomes possible to print the elements of the immutable list:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">myList</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="map-and-filter-on-an-immutable-list">
<h3>Map and filter on an immutable list<a class="headerlink" href="#map-and-filter-on-an-immutable-list" title="Permalink to this heading">¶</a></h3>
<p>Since an immutable list cannot be changed, we have to create a new immutable list if we want to change the content of the list. To this end, let us implement the <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code> methods that are <a class="reference internal" href="#stream-intermediate-methods"><span class="std std-ref">the most common intermediate operations in a stream pipeline</span></a>. We first add the two abstract methods to our <code class="docutils literal notranslate"><span class="pre">ImmutableList&lt;T&gt;</span></code> interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">forEach</span><span class="p">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="p">);</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operator</span><span class="p">);</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the base case of an empty immutable list, both <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code> simply have to return a new empty list:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Nil</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Nil</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Nil</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As far as a non-empty node is concerned, the concrete class is implemented as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cons</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create a new list with the transformed current value, followed by the transformed tail of the list</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cons</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">operator</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">next</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">operator</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">predicate</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cons</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">next</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">predicate</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">next</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">predicate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let us for instance consider the operation <code class="docutils literal notranslate"><span class="pre">myList.map(x</span> <span class="pre">-&gt;</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">3)</span></code> on our immutable list containing 10, 20, and 30. If we expand the recursive calls, we get the following sequence of operations:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myList.map(x -&gt; x + 3)
&lt;=&gt; new Cons(10 + 3, list2.map(x -&gt; x + 3))
&lt;=&gt; new Cons(10 + 3, new Cons(20 + 3, list3.map(x -&gt; x + 3)))
&lt;=&gt; new Cons(10 + 3, new Cons(20 + 3, new Cons(30 + 3, empty.map(x -&gt; x + 3))))
&lt;=&gt; new Cons(10 + 3, new Cons(20 + 3, new Cons(30 + 3, new Nil())))
&lt;=&gt; ImmutableList&lt;Integer&gt; containing: [13, 23, 33]
</pre></div>
</div>
<p>Thanks to those <code class="docutils literal notranslate"><span class="pre">map()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code> methods, we can chain operations to create more complex pipelines, for instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">myList</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="na">map</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
</pre></div>
</div>
<p>Evidently, our <code class="docutils literal notranslate"><span class="pre">ImmutableList&lt;T&gt;</span></code> data structure could be further improved by replicating all the methods that are available to design <a class="reference internal" href="#java-streams"><span class="std std-ref">stream pipelines</span></a>.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/lepl1402.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part1.html">From Python to Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Object-Oriented Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">Unit testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">Algorithms and Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">Parallel Programming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Functional Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nesting-classes">Nesting classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-interfaces-and-lambda-functions">Functional interfaces and lambda functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-purpose-functional-interfaces">General-purpose functional interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#streams">Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programming-without-side-effects">Programming without side effects</a></li>
</ul>
</li>
</ul>

  <div>
    <h3><a href="index.html">Download the book</a></h3>
    <a href="_static/lepl1402.pdf">PDF version of the book</a>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="part5.html" title="Parallel Programming"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">LEPL1402  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Functional Programming</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Sébastien Jodogne, Ramin Sadre, Pierre Schaus.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
    </div>
<div class="footer">
    <script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

<script>
//open external links in a new window
function external_new_window() {
    for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) {
        var b = c[a];
        if(b.getAttribute("href") && b.hostname !== location.hostname) {
            b.target = "_blank";
            b.rel = "noopener";
        }
    }
}
//open PDF links in a new window
function pdf_new_window ()
{
    if (!document.getElementsByTagName) return false;
    var links = document.getElementsByTagName("a");
    for (var eleLink=0; eleLink < links.length; eleLink ++) {
    if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) {
        links[eleLink].onclick =
        function() {
            window.open(this.href);
            return false;
        }
    }
    }
}
pdf_new_window();
external_new_window();
</script>


  </body>
</html>